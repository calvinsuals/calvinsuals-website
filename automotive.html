<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>汽车项目 - calvinsuals</title>
    <!-- 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400&family=Montserrat:wght@300;400;500;700&family=Raleway:wght@300;400&family=Open+Sans:wght@300;400&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500&family=M+PLUS+Rounded+1c:wght@400;500&family=Varela+Round&family=Quicksand:wght@400;500&family=Comfortaa:wght@400;500&display=swap" rel="stylesheet">
    <!-- 样式 -->
    <!-- <link rel="stylesheet" href="navigation.css"> --> <!-- Temporarily commented out due to MIME type errors -->
    <!-- <link rel="stylesheet" href="footer.css"> --> <!-- Temporarily commented out due to MIME type errors -->
    <!-- <link rel="stylesheet" href="titles.css"> -->
    <!-- <link rel="stylesheet" href="styles.css"> --> <!-- Temporarily commented out due to MIME type errors -->
    <!-- <link rel="stylesheet" href="gallery.css"> -->
    <link rel="stylesheet" href="automotive.css">
    <style>
        /* --- Global Reset & Base --- */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #a89b8d;
            color: #ffffff;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            overflow-x: hidden;
        }

        body.automotive-page {
            background-color: #a89b8d;
        }
        
        .projects-page {
            padding: 0;
            margin: 0;
            position: relative;
        }

        /* --- Car Gallery Container --- */
        .showcase-container {
            margin: 0 auto;
        }
        
        /* --- Navigation Menu CSS --- */
        
        .main-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }
        
        .nav-container {
            position: relative;
        }
        
        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 10px 5px;
            background-color: transparent;
        }
        
        .menu-toggle span {
            display: block;
            width: 100%;
            height: 2px;
            background-color: grey;
            transition: all 0.3s;
        }
        
        .menu-toggle.active span:nth-child(1) {
            transform: translateY(8px) rotate(45deg);
        }
        
        .menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }
        
        .menu-toggle.active span:nth-child(3) {
            transform: translateY(-8px) rotate(-45deg);
        }
        
        .menu-content {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            transform: translateY(-100%);
            transition: transform 0.4s cubic-bezier(0.645, 0.045, 0.355, 1);
            visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .menu-content.active {
            transform: translateY(0);
            visibility: visible;
        }
        
        .menu-items {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: auto;
            width: 100%;
            max-width: 400px;
        }
        
        .menu-items a {
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            text-decoration: none;
            padding: 15px 0;
            margin: 5px 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            transition: transform 0.3s ease;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
            line-height: normal;
        }
        
        .menu-items a:hover {
            transform: translateY(-3px);
        }
        
        .menu-items a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            transition: width 0.3s ease;
        }
        
        .menu-items a:hover::after {
            width: 60%;
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* 电脑端菜单样式 */
        @media screen and (min-width: 1024px) {
            .menu-toggle {
                position: fixed;
                top: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
                z-index: 1001;
            }
            
            .menu-content {
                width: 100vw;
                left: 50%;
                transform: translateY(-100%) translateX(-50%);
                margin-left: 0;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
            }
            
            .menu-content.active {
                transform: translateY(0) translateX(-50%);
            }
            
            .menu-items {
                margin: 0 auto;
                padding: 0;
                width: 100%;
                max-width: 400px;
                position: relative;
                transform: translateX(0);
                left: 0;
                right: 0;
            }
            
            .menu-items a {
                text-align: center;
                width: 100%;
                padding: 15px 0;
                margin: 5px 0;
                font-size: 1.5rem;
            }
        }
        
        /* 移动端菜单样式 */
        @media screen and (max-width: 767px) {
            /* 移除移动端缩小汉堡包图标的规则 
            .menu-toggle {
                top: 15px;
                right: 15px;
                width: 35px;
                height: 35px;
            }
            */
            
            .menu-content {
                width: 100% !important;
                left: 0 !important;
                margin-left: 0 !important;
                height: 100%;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
            }
            
            .menu-items {
                height: auto !important;
                max-width: 300px !important;
            }
            
            .menu-items a {
                font-size: 1.2rem;
                padding: 12px 0;
                margin: 8px 0;
            }
        }

        #gallery-sections-container {
            margin-top: 0; /* REMOVED top margin for spacing below header for seamless connection */
        }

        .showcase-section {
            margin-bottom: 10vh; /* 底部间距从30vh减小到10vh */
            position: relative;
            margin-top: 30px; /* 增加顶部间距 */
        }

        /* 调整页脚样式与主页保持一致 */
        .footer {
            position: static;
            background-color: transparent !important; /* 改为透明背景 */
            color: rgba(0, 0, 0, 0.7); /* 修改为深色文字，以适应浅色背景 */
            text-align: center;
            padding: 15px 0;
            width: 100%;
            max-width: 1800px;
            margin: 0 auto;
        }

        .footer p {
            margin: 0;
            font-size: 0.9rem;
            font-family: 'Montserrat', sans-serif; /* 确保使用与主页相同的字体 */
        }

        @media (max-width: 767px) {
            .footer {
                padding: 15px 0;
                width: 100%;
            }
            
            .footer p {
                font-size: 0.8rem;
            }
        }

        /* REMOVED background and shadow from title container for seamless connection */
        .page-title-container {
            /* background-color: rgba(138, 126, 113, 0.6); */
            padding: 15px 0;
            width: 100%;
            /* box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); */
            display: block;
            margin: 0;
            border-radius: 0;
        }

        /* 画廊占位符样式 */
        .gallery-placeholder {
            width: 100%;
            min-height: 260px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            font-size: 1.1em;
            text-align: center;
            padding: 20px;
        }

        /* 平板端样式 (768px - 1280px) */
        @media screen and (min-width: 768px) and (max-width: 1280px) {
            .gallery-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr); /* 两列布局 */
                gap: 20px;
                padding: 0 30px;
                width: 600px; /* 固定宽度为600px */
                margin: 0 auto;
            }

            .gallery-item {
                width: 100%;
                margin-bottom: 0;
            }

            .gallery-item img {
                width: 100%;
                height: auto;
                border-radius: 8px;
                transition: transform 0.3s ease;
            }

            .section-title {
                margin-left: 30px;
                margin-bottom: 30px;
            }

            /* 调整画廊容器宽度 */
            .showcase-container {
                width: 600px !important;
                margin-left: auto;
                margin-right: auto;
            }

            /* 调整图片容器宽度 */
            .car-gallery {
                width: 600px !important;
            }

            /* 调整单个图片尺寸 */
            .car-gallery img {
                width: 290px !important; /* 考虑到间距，每张图片290px */
                height: auto;
            }
        }

        /* 桌面端样式 */
        @media screen and (min-width: 1281px) {
            .gallery-container {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 30px;
                padding: 0 40px;
                max-width: 1800px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body class="automotive-page">
    <!-- 导航菜单 -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="menu-content">
                <div class="menu-items">
                    <a href="index.html">HOME</a>
                    <a href="automotive.html" class="active">AUTOMOTIVE</a>
                    <a href="portrait.html">PORTRAIT</a>
                    <a href="pricing.html">PRICING</a>
                    <a href="index.html#about">ABOUT</a>
                    <a href="index.html#contact">CONTACT</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- 标题背景区域 -->
    <div class="title-background">
        <div class="title-text">AUTOMOTIVE</div>
        <div class="title-text">PROJECTS</div>
    </div>

    <!-- Main container for all gallery sections -->
    <main id="gallery-sections-container" class="main-container">
        <!-- 内容将由 JavaScript 动态生成 -->
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <p>&copy; 2025 calvinsuals. All photography works and website content are copyrighted by the author.</p>
        <p>Website design and development: calvinsuals.</p>
    </footer>

    <script>
        // Revised Menu Control Code
        const menuToggle = document.querySelector('.menu-toggle'); // Use querySelector for class
        const menuContent = document.querySelector('.menu-content'); // Use querySelector for class

        if (menuToggle && menuContent) { // Check if elements exist
            menuToggle.addEventListener('click', () => {
                menuToggle.classList.toggle('active'); // Toggle active state on the button
                menuContent.classList.toggle('active'); // Toggle active state on the menu content
                // Optional: Add visibility control based on active class if CSS doesn't handle it
                 if (!menuContent.classList.contains('active')) {
                     // Small delay to allow animation before hiding completely
                     setTimeout(() => {
                         menuContent.style.visibility = 'hidden';
                     }, 400); // Match CSS transition duration if any
                 } else {
                     menuContent.style.visibility = 'visible';
                 }
            });

            // Optional: Close menu when a link is clicked
            const menuItems = document.querySelectorAll('.menu-items a');
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    menuToggle.classList.remove('active');
                    menuContent.classList.remove('active');
                     setTimeout(() => {
                         menuContent.style.visibility = 'hidden';
                     }, 400);
                });
            });

        } else {
            console.error('Error: Menu toggle button (.menu-toggle) or menu content (.menu-content) not found.');
        }

        // --- 新的子画廊加载代码 ---
        async function displaySubGalleries(galleryType) {
            const mainContainer = document.getElementById('gallery-sections-container');
            if (!mainContainer) {
                console.error('Error: Main container #gallery-sections-container not found.');
                    return;
                }
            mainContainer.innerHTML = ''; // 清空现有内容

            const basePath = `images/${galleryType}`; // e.g., images/automotive
            const mainGalleryListFile = `${basePath}/galleries.json`;

            console.log(`[${galleryType}] Loading main gallery list from: ${mainGalleryListFile}`);

            try {
                const response = await fetch(mainGalleryListFile);
                    if (!response.ok) { 
                   // 备用逻辑: 尝试加载旧的 images.json (保持不变)
                   console.warn(`[${galleryType}] ${mainGalleryListFile} not found or failed (${response.status}). Trying to load old images.json directly.`);
                   const fallbackResponse = await fetch(`${basePath}/images.json`);
                   if (!fallbackResponse.ok) {
                       throw new Error(`Neither ${mainGalleryListFile} nor ${basePath}/images.json could be loaded.`);
                   }
                   const images = await fallbackResponse.json();
                   console.log(`[${galleryType}] Loaded images directly from fallback ${basePath}/images.json`);
                   
                   // *** 创建匹配原始设计的备用HTML结构 ***
                   const showcaseSection = document.createElement('section');
                   showcaseSection.classList.add('showcase-section');

                   const galleryBackground = document.createElement('div');
                   galleryBackground.classList.add('gallery-background');
                   showcaseSection.appendChild(galleryBackground);

                   const showcaseContainer = document.createElement('div');
                   showcaseContainer.classList.add('showcase-container');
                   galleryBackground.appendChild(showcaseContainer);

                   const galleryContainer = document.createElement('div');
                   galleryContainer.classList.add('car-gallery-container'); 
                   showcaseContainer.appendChild(galleryContainer);
                   
                   const imageScrollContainer = document.createElement('div');
                   imageScrollContainer.classList.add('car-gallery');
                   galleryContainer.appendChild(imageScrollContainer);

                   images.forEach((imageName, index) => {
                       const imagePath = `${basePath}/${imageName}`;
                       const imgElement = document.createElement('img'); // Image directly inside .car-gallery
                       imgElement.src = imagePath;
                       imgElement.alt = `${galleryType} Gallery - Image ${index + 1}`;
                       imgElement.loading = 'lazy';
                       imgElement.onerror = () => {
                           console.error(`[${galleryType}] Image failed to load: ${imagePath}`);
                           // Optionally hide broken images, but don't remove the element itself here
                           imgElement.style.display = 'none'; 
                       };
                       imageScrollContainer.appendChild(imgElement);
                   });
                   mainContainer.appendChild(showcaseSection);
                   initializeDragScroll(imageScrollContainer); // Target .car-gallery for scroll
                   return; 
                 }

                // --- 主要逻辑: 加载 galleries.json (调整结构) --- 
                const galleryList = await response.json();
                console.log(`[${galleryType}] Found ${galleryList.length} sub-galleries.`);

                if (galleryList.length === 0) {
                    mainContainer.innerHTML = '<p class="gallery-placeholder">暂无画廊数据。</p>';
                    return;
                }

                // 遍历主画廊列表中的每个子画廊定义
                for (const galleryInfo of galleryList) {
                    if (!galleryInfo.id || !galleryInfo.jsonFile) {
                        console.warn(`[${galleryType}] Skipping gallery entry due to missing id or jsonFile:`, galleryInfo);
                        continue;
                    }

                    const subGalleryId = galleryInfo.id;
                    const subGalleryTitle = galleryInfo.title || subGalleryId.replace('_', ' ');
                    const subGalleryPath = `${basePath}/${subGalleryId}`;
                    // *** 修正 JSON 路径构建 ***
                    // const subGalleryJsonPath = `${subGalleryPath}/${galleryInfo.jsonFile}`; // 旧的错误方式
                    const subGalleryJsonPath = `${basePath}/${galleryInfo.jsonFile}`; // 正确方式：基础路径 + galleries.json 提供的相对路径

                    console.log(`[${galleryType}] Processing sub-gallery: ${subGalleryTitle} (Path: ${subGalleryPath}, JSON: ${subGalleryJsonPath})`);

                    try {
                        const response = await fetch(subGalleryJsonPath);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                        }
                        // *** 修改这里：处理返回的数组结构 ***
                        const subGalleryDataArray = await response.json();
                        let subGalleryImages = []; // 初始化为空数组
                        
                        // 检查返回的是否是数组，且包含元素
                        if (Array.isArray(subGalleryDataArray) && subGalleryDataArray.length > 0) {
                            // 检查第一个元素是否有 images 数组
                            if (subGalleryDataArray[0] && Array.isArray(subGalleryDataArray[0].images)) {
                                subGalleryImages = subGalleryDataArray[0].images;
                                console.log(`[${galleryType}] Successfully parsed JSON for sub-gallery: ${subGalleryTitle}, found ${subGalleryImages.length} images.`);
                            } else {
                                console.warn(`[${galleryType}] JSON structure for ${subGalleryTitle} is incorrect. Missing 'images' array in the first object.`);
                            }
                        } else {
                             console.warn(`[${galleryType}] JSON data for ${subGalleryTitle} is not a valid array or is empty.`);
                        }
                        // *** 修改结束 ***

                        // --- 创建 HTML 结构 (使用 automotive.css 的类名) ---
                        // *** 使用修正后的 subGalleryImages 数组 ***
                        if (subGalleryImages.length > 0) { 
                            const showcaseSection = document.createElement('section');
                            showcaseSection.classList.add('showcase-section');
                            showcaseSection.id = `showcase-${subGalleryId}`;

                            const galleryBackground = document.createElement('div');
                            galleryBackground.classList.add('gallery-background');
                            showcaseSection.appendChild(galleryBackground);

                            const showcaseContainer = document.createElement('div');
                            showcaseContainer.classList.add('showcase-container');
                            galleryBackground.appendChild(showcaseContainer);

                            const galleryContainer = document.createElement('div');
                            galleryContainer.classList.add('car-gallery-container'); 
                            galleryContainer.id = `subgallery-${subGalleryId}`;
                            showcaseContainer.appendChild(galleryContainer);

                            const imageScrollContainer = document.createElement('div');
                            imageScrollContainer.classList.add('car-gallery');
                            galleryContainer.appendChild(imageScrollContainer);

                            subGalleryImages.forEach((imageName, index) => {
                                // 直接创建 img 元素并添加到 car-gallery
                                const imgElement = document.createElement('img');
                                // !!! 直接使用 R2 URL !!!
                                imgElement.src = imageName; // 使用从 JSON 读取的 R2 URL
                                imgElement.alt = `${subGalleryTitle} - Image ${index + 1}`;
                                imgElement.loading = 'lazy';

                                imgElement.onerror = () => {
                                    // !!! 修改错误日志中的路径 !!!
                                    console.error(`[${galleryType} - ${subGalleryTitle}] Image failed to load: ${imageName}`); // 打印 R2 URL
                                    imgElement.alt = `Failed to load ${imageName}`;
                                    imgElement.style.display = 'none';
                                };
                                imageScrollContainer.appendChild(imgElement);
                            });

                            mainContainer.appendChild(showcaseSection); // Add the whole section
                            console.log(`[${galleryType}] Added styled section for sub-gallery: ${subGalleryTitle}`);
                            initializeDragScroll(imageScrollContainer); // Target .car-gallery for scroll
                        } else {
                            // --- 占位符逻辑 (也使用新结构) ---
                             console.log(`[${galleryType}] Skipping section for sub-gallery ${subGalleryTitle} as it has no images.`);
                             const showcaseSection = document.createElement('section');
                             showcaseSection.classList.add('showcase-section');
                            
                const showcaseContainer = document.createElement('div');
                             showcaseContainer.classList.add('showcase-container');
                             showcaseSection.appendChild(showcaseContainer);

                             const placeholderContainer = document.createElement('div');
                             placeholderContainer.classList.add('car-gallery-container'); // Use the styled container
                             showcaseContainer.appendChild(placeholderContainer);
                            
                            const imageScrollContainer = document.createElement('div');
                            mainContainer.appendChild(showcaseSection);
                        }
                         // --- HTML 结构创建结束 ---

                    } catch (error) {
                        console.error(`[${galleryType}] Error processing sub-gallery ${subGalleryTitle} (${subGalleryJsonPath}):`, error);
                    }
                }

                console.log(`[${galleryType}] Finished processing all sub-galleries.`);

            } catch (error) {
                console.error(`Error loading gallery data for ${galleryType}:`, error);
                mainContainer.innerHTML = '<p class="gallery-placeholder">加载画廊列表时出错。请检查控制台获取详细信息。</p>';
            }
        }

        // --- 拖动滚动功能 (确保目标是 .car-gallery) ---
        function initializeDragScroll(element) { // element is now .car-gallery
            if (!element) return;
                    let isDown = false;
                    let startX;
                    let scrollLeft;

            // Mouse Down: Start dragging
            element.addEventListener('mousedown', (e) => {
                // 只响应左键点击
                        if (e.button !== 0) return; 
                        isDown = true;
                element.classList.add('active-drag');
                startX = e.pageX - element.offsetLeft;
                scrollLeft = element.scrollLeft;
                element.style.cursor = 'grabbing';
                element.style.userSelect = 'none';
                // 阻止浏览器默认的图片拖拽行为，这很重要
                e.preventDefault();
            });

            // Mouse Leave: Stop dragging if mouse leaves the element while pressed
            element.addEventListener('mouseleave', () => {
                // 只有在鼠标按下的情况下离开才重置状态
                        if (!isDown) return;
                        isDown = false;
                element.classList.remove('active-drag');
                element.style.cursor = 'grab';
                element.style.removeProperty('user-select');
            });

            // *** Global Mouse Up: Stop dragging wherever the mouse is released ***
                    window.addEventListener('mouseup', (e) => { 
                // 只响应左键抬起
                        if (e.button !== 0) return; 
                // 只有在鼠标是按下状态时才处理抬起
                if (!isDown) return;
                        isDown = false;
                // 确保样式在 window 抬起时也被重置
                 if (element.classList.contains('active-drag')) {
                     element.classList.remove('active-drag');
                     element.style.cursor = 'grab';
                     element.style.removeProperty('user-select');
                 }
            });

            // Mouse Move: Perform scrolling only if dragging
            element.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                // 不需要再次 preventDefault，因为 mousedown 时已经阻止了
                const x = e.pageX - element.offsetLeft;
                const walk = (x - startX) * 1; // 使用上次调整的灵敏度
                element.scrollLeft = scrollLeft - walk;
            });

             // 初始设置 grab 光标
             element.style.cursor = 'grab';
        }

        // --- 页面加载时调用 ---
        document.addEventListener('DOMContentLoaded', () => {
            displaySubGalleries('automotive'); // 指定画廊类型为 'automotive'
        });

    </script>
</body>
</html>